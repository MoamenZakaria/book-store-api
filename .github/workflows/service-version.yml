name : Print Service Version

on :
  workflow_dispatch:

jobs:
  build:
    # üñäÔ∏è Uncomment this if you are using CRDA scan step above
    # needs: crda-scan
    name: Build 
    runs-on: ubuntu-20.04
    steps:
    - name: checkout
      uses: actions/checkout@v3
    - name: Setup Java JDK
      uses: actions/setup-java@v3.13.0
      with: 
        java-version: 17
        distribution: temurin
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2.9.0
    - name: Run build with Gradle Wrapper
      run: gradle build test
    - name: Set version number
      run: |
        python - <<END
        with open("build.gradle", "r") as f:
            lines = f.readlines()
        for line in lines:
            stripped = line.strip()
            if stripped.startswith("version '"):
                version = stripped.split("'")[1]
                print(f"Found version: {version}")
                print(f"::set-env name=VERSION::{version}")
                break
        END
